[["highlighting.html", "Chapter 8 Highlighting Freaks, Shifts, and Trends", " Chapter 8 Highlighting Freaks, Shifts, and Trends cdiff &lt;- read.csv(&#39;data/cdiff.csv&#39;, comment.char = &#39;#&#39;, colClasses = c(&#39;Date&#39;, &#39;integer&#39;, &#39;integer&#39;)) cdiff &lt;- within(cdiff, { cl &lt;- mean(infections) lcl &lt;- cl - 3 * sqrt(cl) ucl &lt;- cl + 3 * sqrt(cl) }) head(cdiff) ## month infections risk_days ucl lcl cl ## 1 2020-01-01 12 19801 11.77776 -1.69443 5.041667 ## 2 2020-02-01 7 18674 11.77776 -1.69443 5.041667 ## 3 2020-03-01 1 15077 11.77776 -1.69443 5.041667 ## 4 2020-04-01 4 12062 11.77776 -1.69443 5.041667 ## 5 2020-05-01 4 14005 11.77776 -1.69443 5.041667 ## 6 2020-06-01 5 14840 11.77776 -1.69443 5.041667 with(cdiff, { spc(month, infections, cl, lcl, ucl) }) spc &lt;- function( x, # x axis values y = NULL, # data values cl = NA, # centre line lcl = NA, # lower control limit ucl = NA, # upper control limit ... # other parameters passed to the plot() function ) { # if y is missing, set y to x and make a sequence for x if (is.null(y)) { y &lt;- x x &lt;- seq_along(y) } # repeat line values to match the length of y if (length(cl) == 1) cl &lt;- rep(cl, length(y)) if (length(lcl) == 1) lcl &lt;- rep(lcl, length(y)) if (length(ucl) == 1) ucl &lt;- rep(ucl, length(y)) # find data points outside control limits sigma.signal &lt;- y &lt; lcl | y &gt; ucl sigma.signal[is.na(sigma.signal)] &lt;- FALSE # runs analysis if (all(is.na(cl))) { runs.signal &lt;- FALSE } else { runs &lt;- sign(y - cl) runs &lt;- runs[runs != 0 &amp; !is.na(runs)] run.lengths &lt;- rle(runs)$lengths n.useful &lt;- sum(run.lengths) longest.run &lt;- max(run.lengths) n.crossings &lt;- length(run.lengths) - 1 longest.run.max &lt;- round(log2(n.useful)) + 3 n.crossings.min &lt;- qbinom(0.05, n.useful - 1, 0.5) runs.signal &lt;- longest.run &gt; longest.run.max | n.crossings &lt; n.crossings.min } # make empty plot plot(x, y, type = &#39;n&#39;, ylim = range(y, lcl, ucl, na.rm = TRUE), ...) # add centre line, coloured and dashed if unusually long runs or unusuall # few crossing were identified by the runs analysis lines(x, cl, col = runs.signal + 1, lty = runs.signal + 1) # add control limits lines(x, lcl) lines(x, ucl) # add data line and points, colour data points outside control limits lines(x, y) points(x, y, pch = 19, col = sigma.signal + 1) } with(cdiff, { spc(month, infections, cl, lcl, ucl) }) "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
